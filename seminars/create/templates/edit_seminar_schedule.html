{% extends "homepage.html" %}
{% block content %}

<h1>{{seminar.name}}</h1>
<div class="text_content">
<p> To add a talk at a regularly scheduled time, enter Speaker (and optionally Email and Title) in row(s) of the table; and then click "Save changes" or any "Details" link.</p>

<p>To add a talk at <i>any</i> time, under <a href="#add_new_talk">Add talk</a>, enter, Date, Start and End times, and Speaker (and optionally Email and Title); then click "Save changes" or any "Details" link.</p>


<p>All times are shown in the seminar's time zone, {{ seminar.timezone }}.</p>
</div>


<form action="{{ url_for('.save_seminar_schedule') }}" method="POST">
  <input type="hidden" name="shortname" value="{{ seminar.shortname }}"/>
  <input type="hidden" name="new" value="{{ 'yes' if seminar.new else 'no' }}"/>
  <input type="hidden" name="schedule_count" value="{{ all_dates | length }}" />
  <h2>Upcoming schedule <button type="submit">Save changes</button></h2>
  <table id="edit-schedule-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Speaker</th>
        <th>Email</th>
        <th>Title</th>
        <th></th>
      </tr>
    </thead>
    {% for date in all_dates %}
    {% set i = loop.index0 %}
    {% if date in by_date %}
    {% for talk in by_date[date] %}
    <tr>
      <td class="date">
        {{ date.strftime("%a %b %-d") }}
      </td>
      <td>
        {{ talk.start_time.strftime("%-H:%M") }}-{{ talk.end_time.strftime("%-H:%M") }}
      </td>
      <td>
        <input name="speaker{{i}}" value="{{ talk.speaker | blanknone }}" style="width:160px;" />
      </td>
      <td>
        <input name="speaker_email{{i}}" value="{{ talk.speaker_email | blanknone }}" style="width:160px;" />
      </td>
      <td>
        <input name="title{{i}}" value="{{ talk.title | blanknone }}" style="width:320px;" />
      </td>
      <td>
        {{ talk.edit_link() | safe }}
      </td>
      <input type="hidden" name="seminar_ctr{{i}}" value="{{ talk.seminar_ctr }}" />
      <input type="hidden" name="date{{i}}" value="{{ date.isoformat() }}" />
    </tr>
    {% endfor %}
    {% else %}
    <tr>
      <td class="date">
        {{ date.strftime("%a %b %-d") }}
      </td>
      <td>
        {% if seminar.start_time and seminar.end_time %}
        {{ seminar.start_time.strftime("%-H:%M") }}-{{ seminar.end_time.strftime("%-H:%M") }}
        {% else %}
        <input name="time{{i}}" value="{{ raw_data['time%s'%i] }}" style="width:160px;" />
        {% endif %}
      </td>
      <td>
        <input name="speaker{{i}}" value="{{ raw_data['speaker%s'%i] }}" style="width:160px;" />
      </td>
      <td>
        <input name="speaker_email{{i}}" value="{{ raw_data['speaker_email%s'%i] }}" style="width:160px;" />
      </td>
      <td>
        <input name="title{{i}}" value="{{ raw_data['title%s'%i] }}" style="width:320px;" />
      </td>
      <td></td>
      <input type="hidden" name="seminar_ctr{{i}}" value="" />
      <input type="hidden" name="date{{i}}" value="{{ date.isoformat() }}" />
    </tr>
    {% endif %}
    {% endfor %}
  </table>
</form>

<div name="add_new_talk">
<h3>Add talk (time not listed above)</h3>

<form action="{{ url_for('.edit_talk') }}" method="POST">
  <input type="hidden" name="seminar_id" value="{{ seminar.shortname }}"/>
  <table>
    <tr>
      <td>Date</td>
      <td><input name="date" /></td>
    </tr>
    <tr>
      <td>Start time</td>
      <td><input name="start_time" value="{{ seminar.show_start_time(adapt=False) }}" /></td>
    </tr>
    <tr>
      <td>End time</td>
      <td><input name="end_time" value="{{ seminar.show_end_time(adapt=False) }}" /></td>
    </tr>
    <tr>
      <td><button type="submit">Add to schedule</button></td>
    </tr>
  </table>
</form>
</div>

{% endblock %}
